
# MAC과 IP 주소는 어떻게 연결될까?

Mac 주소는 데이터 링크 계층에서 사용되고, IP 주소는 네트워크 계층에서 사용된다.
**ARP(Address Resoltuin Protocol)** 는 두 계층을 연결하는 역할을 한다.

## 데이터를 전송하는 흐름 확인

네트워크 계층의 IP는 패킷에서 목적지 IP 주소를 보고, 이더넷에 패킷을 전달하고자 목적지 MAC 주소를 조사하는데, 이때 이용하는 것이 ARP이다.

목적지 IP주소 192.168.5.10에 패킷을 전송하는 흐름은 아래와 같다.
1. 목적지 IP 주소 192.168.5.10 을 가진 MAC 주소를 ARP가 검색해서 알려줌
2. IP는 전달받은 MAC 주소를 패킷의 MAC 헤더에 추가해서 데이터를 전송

![](https://i.imgur.com/CtH9yHf.png)

### mac이 필요한가?
우리가 패킷을 보낼 때는 **L3(네트워크 계층)** 에서는 IP 주소로, **L2(데이터링크 계층)** 에서는 MAC 주소로 전달한다.

예를 들어 IP는 어디 나라/도시/집 인지 논리적인 위치를 알려준다면, MAC은 집 안의 누구인지(물리적 장치 식별)을 알려준다.

IP주소는  DHCP 등에 의해 변할 수 있지만 MAC은 네트워크 카드에 고정되어 있는 값이다.
MAC만 사용하면 되지 않을까? 라는 의문이 들 수 있지만, 네트워크 규모가 커질 수 록 라우팅이 불가능해진다.
MAC 주소만으로는 이 장치가 어디 네트워크에 있는가? 를 알 수가 없기에 **네트워크 기반** IP로 라우터들이 목적지 경로를 계산하고, MAC을 통해 원하는 장치에 접속할 수 있다.

## ARP는 어떻게 MAC 주소를 찾을까?

ARP가 IP 주소로 MAC 주소를 검색하는 과정은 아래 세 단계를 거치고, 
**ARP 요청, ARP 응답, ARP 캐싱** 이라고 한다.

1. 같은 네트워크 기기를 전체 호출(ARP 요청)
2. 호출한 조건에 맞는 기기가 응답(ARP 응답)
3. 조회한 결과를 기록(ARP 캐싱)
	- ARP 캐시 정보는 ARP 테이블이라는 곳에 있음
	- 윈도우 기준 arp -a
 
![](https://i.imgur.com/Dp4b1Fr.png)

