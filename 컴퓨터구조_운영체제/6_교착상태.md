# 교착상태란

자원 A를 점유한 프로세스 P1이 자원 B를 점유 중인 프로세스 P2가 사용이 끝나길 기다리고
프로세스 P2는 A를 위해 P1을 기다린다면, 서로 기다리기만 하다가 실행 한번을 못하는 상황이 일어난다

이를 교착 상태 라고 한다.

## 자원 할당 그래프
> 교착 상태를 자원 할당 그래프(resource-allocation graph)를 통해 표현할 수 있다.

1. 프로세스는 원으로, 자원의 종료는 사각형으로
2. 사용 가능한 자원의 갯수는 점으로
3. 프로세스가 자원을 할당받아 사용 중이라면, 자원에서 프로세스를 향해 화살표를 표시
4. 프로세스가 어떤 자원을 기다리고 있다면, 프로세스에서 자원으로 화살표를 표시

![](https://i.imgur.com/uhUWRXI.png)

이렇게 자원 할당 그래프가 원의 형태를 띄고 있으면 교착 상태 이다.

## 교착 상태 발생 조건
> 교착 상태가 발생하는 조건에는 4가지가 있다.
> 상호 배체, 점유와 대기, 비선점, 원형 대기

### 상호 배제(mutual exclusion)
교착 상태가 발생한 근본적인 원인은 해당 자원을 한 번에 하나의 프로세스만 이용가능 하기 때문이다.
하나의 프로세스가 사용 중인 자원을 다른 프로세스가 사용 할 수 없을 때 **상호 배제** 상황에서 교착 상태가 발생할 수 있다.

### 점유와 대기(hold and wait)
자원을 보유한 채 다른 자원을 기다린다면, 교착 상태가 발생할 수 있다.
이렇게 자원을 할당 받은 상태에서 다른 자원을 할당받기를 기다리는 상태를 **점유와 대기** 라고 한다.

### 비선점(nonpreemptive)
어떤 프로세스도 다른 프로세스가 사용 중인 자원을 강제로 뺏지 못했지 때문에 교착 상태가 발생했다고 볼 수 있다. 이를 프로세스가 자원을 **비선점** 하고 있다고 한다.

### 원형대기(circular wait)
자원 할당 그래프가 원의 형태로 그려지면 교착 상태가 발생할 수 있고, 이를 **원형 대기** 라고 한다.

# 교착 상태 해결 방법
> 이러한 교착 상태를 해결하기 위해 크게 세가지 방법이 있다.
> OS는 애초에 교착 상태발생 조건에 부합하지 않게 자원을 분배하여 교착 상태를 **예방** 할 수 있고,
> 교착 상태가 발생하지 않을 정도로 조금씩 자원을 할당하다가 교착 상태 위첨이 있다면 자원을 할당하지 않는 방식으로 교착 상태를 **회피** 할 수도 있다.
> 그리고 자원을 제약 없이 할당 하다가, 교착 상태가 **검출** 되면, 교착 상태를 **회복** 하는 방법도 있다.

## 교착 상태 예방
교착 상태를 예방하는 방법은 앞서 본[[6_교착상태#교착 상태 발생 조건]] 의 네 가지 중 하나를 충족하지 못하게 하는 방법과 같다.

### 상호 배제를 없앤다?
자원의 상호 배제를 없앤다는 말의 의미는 모든 자원을 공유 가능하게 하겠다는 말과 같다. 하지만 현실적으로는 불가능한 방법

### 점유와 대기를 없앤다
점유와 대기를 없애면 OS는 특정 프로세스에 자원을 모두 할당 혹은 할당하지 않는 방식으로 배분한다.
하지만 이러한 방식은 자원의 활용률이 낮아진다.

### 비선점 조건을 없앤다
이제 프로세스들은 다른 프로세스들로 부터 해당 자원을 빼앗아 올 수 있다.
하지만, 이 방법 역시 문제가 있는데 예를 들어 프린트를 하는 것을 생각해 보면된다.
결국 범용성이 떨어진다.

### 원형 대기 조건을 없앤다
모든 자원에 번호를 붙이고, 오름차순으로 자원을 할당하면 원형 대기 조건이 사라진다.
가장 현실적이지만 시스템에 존재하는 수많은 자원에 번호를 붙이는 일이 간단하지 않고, 자원의 활용률이 떨어질 수 있다.

## 교착 상태 회피
교착 상태 회피는 교착 상태가 발생하지 않을 정도로만 자원을 할당하는 방식
즉 프로세스들에 배분할 수 있는 자원의 양을 고려하여 교착상태가 발생하지 않을 정도의 양만큼만 자원을 배분하는 방법

회피를 위해 두 가지 상태가 있는데
교착 상태가 발생하지 않고, 모든 프로세스가 정상적으로 자원을 할당받고, 종료될 수 있는 상태를 **안전 상태(safe state)**