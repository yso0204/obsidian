## 장치 컨트롤러

### 전송률

> 일반적으로 CPU와 메모리의 데이터 전송률은 높지만, I/O 장치의 데이터 전송률은 낮다

- 전송률 : 데이터를 어마나 빨리 교환 할 수 있는가?
- 위와 같은 이유로, I/O 장치는 컴퓨터에 직접 연결되지 않고, 장치 컨트롤러라는 HW를 통해서 연결된다.

### 데이터 버퍼링

> 버퍼링이란 전송률이 높은 장치와 낮은 장치 간 주고받는 데이터를 buffer라는 임시 저장 공간에 저장하여 전송률을 비슷하게 맞추는 방법

CPU ↔  버퍼 ↔  I/O 장치

### 장치 컨트롤러 내부

> 장치 컨트롤러 내부는  
> 데이터 레지스터, 상태 레지스터, 제어 레지스터 세가지로 이루어져 있다.

- 데이터 레지스터 : CPU와 I/O 장치 사이에 주고 받을 데이터가 담기는 레지스터장치 간 버퍼 역할을 하며 데이터가 많은 장치에서는 레지스터 대신, RAM이 사용되곤 함
- 상태 레지스터 : I/O 장치가 입출력 작업을 할 준비가 되었는지, 입출력 작업이 완료되었는지, 장치에 오류는 없는지 등의 상세 정보가 저장됨
- 제어 레지스터 : I/O장치가 수행할 내용에 대한 제어 정보와 명령을 저장

## 장치 드라이버

> 새로운 장치를 컴퓨터에 연결하기 위해서는 장치 드라이버를 설치해야한다.  
> 장치 컨트롤러의 동작을 감지하고 제어함으로써 장치 컨틀롤러가 컴퓨터 내부와 정보를 주고 받을 수 있게 해주는 프로그램

* * *

<br>

## 다양한 입출력 방법

### 프로그램 입출력

> 프로그램 속 명령어로 입출력 장치를 제어하는 방법  
> CPU가 프로그램 속 명령어를 실행하는 과정에서 입출력 명령어를 만나면 CPU는 입출력 장비에 연결된 장치 컨트롤러와 상호작용하며 입출력 작업을 수행

- CPU가 모든 장치 컨트롤러들의 레지스터(데이터,상태,제어) 의 주소를 알기는 어렵다그렇다면?
    - 메모리 맵 입출력
    - 고립형 입출력

### 메모리 맵 입출력

> 메모리에 접근하기 위한 주소 공간과 입출력장치에 접근하기 위한 주소 공간을 하나의 주소 공간으로 간주하는 방법

- 예를 들어 1024개의 주소를 표현할 수 있는 컴퓨터에서 512개는 메모리 주소를, 512개는 장치 컨트롤러의 레지스터를 표현하기 위해 사용
    - 516번지 : 프린터 컨트롤러의 데이터 레지스터
    - 517번지 : 프린터 컨트롤러의 상태 레지스터  라고 가정
    - CPU는 516번지, 517번지를 읽어 프린터를 제어할 수 있다.따라서 CPU는 메모리에 접근하는 명령어로 장치들을 컨트롤 할 수 있다.

### 고립형 입출력

> 메모리를 위한 주소 공간과 입출력장치를 위한 주소 공간을 분리하는 방법

- 데이터 버스, 주소 버스, 제어 버스 가 있다고 가정하면, 메모리에 1024개의 주소 공간을 활용하고 입출력장치에도 1024개의 주소를 활용할 수 있다.
- 정리하면 메모리를 위한 주소 공간과 입출력장치를 위한 주소 공간을 분리하는 형태

| 메모리 맵 입출력                    | 고립형 입출력                  |
| ---------------------------- | ------------------------ |
| 메모리와 입출력장치는 같은 주소 공간을 사용     | 메모리와 입출력장치는 분리된 주소 공간 사용 |
| 주소공간을 공유하므로 메모리 주소 공간이 축소된다. | 메모리 주소 공간이 축소 되지 않음      |
| 메모리와 입출력장치에 동일한 명령어로 사용이 가능  | 입출력장치를 위한 전용 명령어가 필요하다.  |
### 인터럽트 기반 입출력
> 인터럽트는 입출력 장치가 CPU에 인터럽트 요청을 신호를 보내면 CPU가 잠시 하던 일을 멈추고 해당 인터럽트를 처리하는 프로그램으로 아래 사진과 같이 입출력 장치의 장치 컨트롤러에 의해 발생한다.

![](https://i.imgur.com/bgOB2if.png)

그렇다면 여러개 인터럽트가 동시에 발생하면 어떻게 될까?

- 인터럽트 간 우선 순위를 고려하고 우선 순위가 높은 순으로 먼저 처리
![](https://i.imgur.com/CsrgxTX.png)

우선순위를 반영하여 다중 인터럽트를 처리할때 여러 방법이 있으나, 
주로 PIC(Programmable Interrupt Controller)란 HW를 이용한다.

### DMA 입출력
> 앞선 입출력들을 모두 CPU가 메모리를 직접 제어한다는 공통점이 있다.
> 이는 결국 CPU에 부하를 주게 된다.

이를 해결하기 위해 DMA라는 컨틀롤러가 있으며, DMA는 CPU에게 입출력 명령을 받으면 CPU를 거치지 않고 메모리와 장치 컨트롤러 간 입출력 작업을 하고 완료 후 CPU에게 인터럽트를 보내 종료를 알린다.
- DMA 역시 시스템 버스를 사용하면, 결국 CPU가 버스를 사용하는 주기를 사용하게 된다. 이를 사이클 스틸링(Cycle Stealing) 이라 부른다
- 이를 위해 별로의 입출력 버스를 두고 사용한다.
	- PCI 버스 , PCIe 버스 등이 있다.